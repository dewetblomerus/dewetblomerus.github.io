---
layout: page
title: SSE Test
permalink: /sse/
---

<div id="sse-container">
  <h1>Server-Sent Events Test with <a href="https://eventblast.io">EventBlast</a></h1>
  <div id="messages"></div>
  <button id="connect-btn">Connect</button>
  <button id="disconnect-btn" disabled>Disconnect</button>

  <div id="endpoint-config">
    <label for="endpoint-input">Organization Slug:</label>
    <input type="text" id="endpoint-input" placeholder="Enter organization slug" value="dw">
    <div id="endpoint-preview"></div>
  </div>
</div>

<script>
  let eventSource = null;
  const messagesDiv = document.getElementById('messages');
  const connectBtn = document.getElementById('connect-btn');
  const disconnectBtn = document.getElementById('disconnect-btn');
  const endpointInput = document.getElementById('endpoint-input');
  const endpointPreview = document.getElementById('endpoint-preview');

  function addMessage(message, type = 'info') {
    const messageElement = document.createElement('div');
    messageElement.className = `message ${type}`;
    messageElement.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
    messagesDiv.appendChild(messageElement);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  function buildEndpointUrl(orgSlug) {
    return `https://api.eventblast.io/v1/subscribe/${orgSlug}/test-topic`;
  }

  function updateEndpointPreview() {
    const orgSlug = endpointInput.value.trim();
    if (orgSlug) {
      const url = buildEndpointUrl(orgSlug);
      endpointPreview.textContent = `Endpoint: ${url}`;
      endpointPreview.className = 'endpoint-preview';
    } else {
      endpointPreview.textContent = '';
    }
  }

  connectBtn.addEventListener('click', function() {
    if (eventSource) {
      return;
    }

    // Get the organization slug from the input field
    const orgSlug = endpointInput.value.trim();

    // Basic validation
    if (!orgSlug) {
      addMessage('Please enter an organization slug', 'error');
      return;
    }

    // Validate organization slug format (alphanumeric, hyphens, underscores)
    if (!/^[a-zA-Z0-9_-]+$/.test(orgSlug)) {
      addMessage('Organization slug can only contain letters, numbers, hyphens, and underscores', 'error');
      return;
    }

    const endpointUrl = buildEndpointUrl(orgSlug);
    addMessage(`Connecting to: ${endpointUrl}`, 'info');
    eventSource = new EventSource(endpointUrl);

    eventSource.onopen = function() {
      addMessage('Connected to SSE stream', 'success');
      connectBtn.disabled = true;
      disconnectBtn.disabled = false;
    };

    eventSource.onmessage = function(event) {
      addMessage(`Received: ${event.data}`, 'data');
    };

    eventSource.onerror = function() {
      addMessage('Connection error occurred', 'error');
      eventSource.close();
      eventSource = null;
      connectBtn.disabled = false;
      disconnectBtn.disabled = true;
    };
  });

  disconnectBtn.addEventListener('click', function() {
    if (eventSource) {
      eventSource.close();
      eventSource = null;
      addMessage('Disconnected from SSE stream', 'info');
      connectBtn.disabled = false;
      disconnectBtn.disabled = true;
    }
  });

  // Update preview when input changes
  endpointInput.addEventListener('input', updateEndpointPreview);

  // Initialize preview on page load
  updateEndpointPreview();

  // Auto-connect on page load
  function autoConnect() {
    // Wait a bit for the page to fully load
    setTimeout(() => {
      const orgSlug = endpointInput.value.trim();
      if (orgSlug && !eventSource) {
        addMessage('Auto-connecting on page load...', 'info');
        connectBtn.click();
      }
    }, 500);
  }

  // Trigger auto-connect when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', autoConnect);
  } else {
    autoConnect();
  }
</script>

<style>
  #sse-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
  }

  #messages {
    border: 1px solid #ccc;
    height: 400px;
    overflow-y: auto;
    padding: 10px;
    margin: 20px 0;
    background-color: #f9f9f9;
    font-family: monospace;
  }

  .message {
    margin: 5px 0;
    padding: 5px;
    border-radius: 3px;
  }

  .message.success {
    background-color: #d4edda;
    color: #155724;
  }

  .message.error {
    background-color: #f8d7da;
    color: #721c24;
  }

  .message.data {
    background-color: #d1ecf1;
    color: #0c5460;
  }

  .message.info {
    background-color: #e2e3e5;
    color: #383d41;
  }

  button {
    padding: 10px 20px;
    margin: 5px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
  }

  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  #connect-btn {
    background-color: #28a745;
    color: white;
  }

  #connect-btn:hover:not(:disabled) {
    background-color: #218838;
  }

  #disconnect-btn {
    background-color: #dc3545;
    color: white;
  }

  #disconnect-btn:hover:not(:disabled) {
    background-color: #c82333;
  }

  #endpoint-config {
    margin-top: 20px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background-color: #f8f9fa;
  }

  #endpoint-config label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    color: #495057;
  }

  #endpoint-input {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ced4da;
    border-radius: 4px;
    font-size: 14px;
    font-family: monospace;
    background-color: white;
    box-sizing: border-box;
  }

  #endpoint-input:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
  }

  .endpoint-preview {
    margin-top: 8px;
    padding: 6px 10px;
    background-color: #e9ecef;
    border: 1px solid #ced4da;
    border-radius: 3px;
    font-family: monospace;
    font-size: 12px;
    color: #495057;
    word-break: break-all;
  }
</style>
